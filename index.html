<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Metadata Remover</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0; 
            background-color: #f0f2f5; 
        }
        .container { 
            background: white; 
            padding: 40px; 
            border-radius: 16px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.08); 
            width: 100%;
            max-width: 450px; 
            text-align: center; 
        }
        h1 { font-size: 26px; color: #1a1a1a; margin-bottom: 10px; }
        p.description { color: #666; font-size: 14px; margin-bottom: 25px; }
        
        .drop-zone { 
            border: 2px dashed #cbd5e0; 
            padding: 30px; 
            border-radius: 12px; 
            margin-bottom: 25px; 
            cursor: pointer; 
            transition: all 0.3s ease;
            background-color: #f8fafc;
        }
        .drop-zone:hover { border-color: #3b82f6; background: #eff6ff; }
        
        #fileName { color: #475569; font-weight: 500; }

        button { 
            background-color: #2563eb; 
            color: white; 
            border: none; 
            padding: 14px 28px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: 600;
            width: 100%; 
            transition: background 0.2s; 
        }
        button:hover { background-color: #1d4ed8; }
        button:disabled { background-color: #94a3b8; cursor: not-allowed; }

        #status { 
            margin-top: 20px; 
            font-size: 14px; 
            color: #4b5563; 
            min-height: 20px;
        }
        input[type="file"] { display: none; }
        
        footer { margin-top: 20px; font-size: 12px; color: #94a3b8; }
    </style>
</head>
<body>

<div class="container">
    <h1>Metadata Remover</h1>
    <p class="description">Upload your images to strip EXIF data and protect your privacy. All processing happens locally in your browser.</p>
    
    <div class="drop-zone" onclick="document.getElementById('fileInput').click()" id="dropZone">
        <p id="fileName">Click to select or drag & drop images</p>
        <p style="font-size: 11px; color: #94a3b8;">Supports JPG, PNG, WEBP</p>
        <input type="file" id="fileInput" multiple accept="image/jpeg, image/png, image/webp">
    </div>

    <button id="processBtn" disabled>Process & Download ZIP</button>
    
    <div id="status"></div>

    <footer>
        Built with Privacy in Mind &bull; Browser-side Processing
    </footer>
</div>

<script>
    const fileInput = document.getElementById('fileInput');
    const processBtn = document.getElementById('processBtn');
    const status = document.getElementById('status');
    const fileNameDisplay = document.getElementById('fileName');

    fileInput.addEventListener('change', () => {
        const files = fileInput.files;
        if (files.length > 0) {
            fileNameDisplay.innerText = `${files.length} file(s) selected`;
            processBtn.disabled = false;
        }
    });

    processBtn.addEventListener('click', async () => {
        const files = fileInput.files;
        if (files.length === 0) return;

        processBtn.disabled = true;
        processBtn.innerText = "Processing...";
        const zip = new JSZip();
        
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            status.innerText = `Cleaning: ${file.name}...`;

            try {
                // Remove metadata by drawing the image onto a Canvas
                const cleanedBlob = await removeMetadata(file);
                zip.file(`clean_${file.name}`, cleanedBlob);
            } catch (e) {
                console.error(`Error processing ${file.name}:`, e);
            }
        }

        status.innerText = "Generating ZIP file...";
        const content = await zip.generateAsync({ type: "blob" });
        
        // Trigger download
        const link = document.createElement("a");
        link.href = URL.createObjectURL(content);
        link.download = "cleansed_images.zip";
        link.click();

        status.innerText = "Success! Metadata has been removed.";
        processBtn.disabled = false;
        processBtn.innerText = "Process & Download ZIP";
    });

    /**
     * core Logic: Drawing an image to a Canvas and exporting it back 
     * strips all EXIF/metadata because Canvas only stores pixel data.
     */
    function removeMetadata(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (event) => {
                const img = new Image();
                img.src = event.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);
                    
                    canvas.toBlob((blob) => {
                        resolve(blob);
                    }, file.type, 0.92); 
                };
            };
            reader.onerror = reject;
        });
    }

    // Basic Drag & Drop functionality
    const dropZone = document.getElementById('dropZone');
    dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.style.borderColor = '#2563eb'; });
    dropZone.addEventListener('dragleave', () => { dropZone.style.borderColor = '#cbd5e0'; });
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.borderColor = '#cbd5e0';
        fileInput.files = e.dataTransfer.files;
        fileInput.dispatchEvent(new Event('change'));
    });
</script>

</body>
</html>